<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Klarna Payment Selector (Val Town Backend)</title>
    <link rel="preconnect" href="https://x.klarnacdn.net" crossorigin>
    <link
      rel="stylesheet"
      href="https://x.klarnacdn.net/ui/fonts/v1.5/fonts.css"
    >
    <link
      rel="stylesheet"
      href="https://js.klarna.com/web-sdk/buttons/payment-button.css"
    >
    <link rel="stylesheet" href="/styles.css">
  </head>
  <body>
    <!-- Configuration Error Banner (hidden by default) -->
    <div class="error-banner" id="config-error" style="display: none">
      ⚠️ <strong>Configuration Error:</strong> <span
        id="config-error-message"
      ></span>
    </div>

    <!-- Main Content: Config Panel + Payment Selector -->
    <div class="main-row">
      <!-- Payment Presentation Config -->
      <div class="panel config-panel">
        <div class="config">
          <div class="collapsible-header" id="payment-config-collapse-header">
            <h3 style="margin: 0; cursor: pointer">
              Payment Presentation Config
            </h3>
            <span class="collapse-icon">▼</span>
          </div>
          <div class="config-collapsible" id="payment-config-collapse-content">
            <div class="field">
              <label for="country">Purchase country (sets currency)</label>
              <select id="country"></select>
            </div>
            <div class="field">
              <label for="locale">Locale</label>
              <select id="locale"></select>
            </div>
            <div class="field">
              <div class="collapsible-header" id="intents-collapse-header">
                <label style="margin: 0; cursor: pointer"
                >Intents (optional)</label>
                <span class="collapse-icon collapsed">▼</span>
              </div>
              <div
                class="collapsible-content collapsed"
                id="intents-collapse-content"
              >
                <!-- Available intents to add -->
                <div class="intent-chips" id="available-intents">
                  <button type="button" class="intent-chip" data-intent="PAY">
                    + PAY
                  </button>
                  <button
                    type="button"
                    class="intent-chip"
                    data-intent="SUBSCRIBE"
                  >
                    + SUBSCRIBE
                  </button>
                  <button
                    type="button"
                    class="intent-chip disabled"
                    data-intent="SIGNUP"
                    disabled
                  >
                    SIGNUP
                  </button>
                  <button
                    type="button"
                    class="intent-chip disabled"
                    data-intent="SIGNIN"
                    disabled
                  >
                    SIGNIN
                  </button>
                  <button
                    type="button"
                    class="intent-chip"
                    data-intent="DONATE"
                  >
                    + DONATE
                  </button>
                  <button
                    type="button"
                    class="intent-chip"
                    data-intent="ADD_TO_WALLET"
                  >
                    + ADD_TO_WALLET
                  </button>
                </div>

                <!-- Selected intents (reorderable) -->
                <div class="selected-intents-label">
                  Selected (drag to reorder):
                </div>
                <div class="selected-intents-list" id="selected-intents">
                  <div class="intent-item" data-intent="PAY" draggable="true">
                    <span class="drag-handle">⋮⋮</span>
                    <span class="intent-name">PAY</span>
                    <button
                      type="button"
                      class="intent-remove"
                      data-intent="PAY"
                    >
                      ×
                    </button>
                  </div>
                </div>
                <div
                  class="selected-intents-empty"
                  id="intents-empty"
                  style="display: none"
                >
                  Click an intent above to add it
                </div>

                <div class="intent-warning" id="intent-warning">
                  ⚠️ Invalid intent combination. Valid: PAY, DONATE, SUBSCRIBE,
                  SIGNUP, SIGNIN, ADD_TO_WALLET, PAY+ADD_TO_WALLET, PAY+SIGNIN,
                  PAY+SUBSCRIBE, DONATE+SIGNIN.
                </div>
              </div>
            </div>
            <div class="field" id="amount-field">
              <label for="amount">Amount (minor units)</label>
              <input id="amount" type="number" min="0" step="1" value="2000" />
            </div>
            <div class="field" id="subscription-billing-interval-field">
              <label for="subscription-billing-interval"
              >Subscription Billing Interval (optional)</label>
              <select id="subscription-billing-interval">
                <option value="">None</option>
                <option value="DAY">DAY</option>
                <option value="WEEK">WEEK</option>
                <option value="MONTH">MONTH</option>
                <option value="YEAR">YEAR</option>
              </select>
            </div>
            <div
              class="field"
              id="subscription-billing-interval-frequency-field"
            >
              <label for="subscription-billing-interval-frequency"
              >Subscription Billing Interval Frequency (optional)</label>
              <input
                id="subscription-billing-interval-frequency"
                type="number"
                min="1"
                step="1"
                placeholder="e.g., 1, 2, 3..."
              />
            </div>
            <div class="status">
              Currency: <span id="currency-pill" class="pill">—</span>
            </div>
          </div>
        </div>

        <!-- Advanced Checkout Flows -->
        <div class="config" style="margin-top: 16px">
          <div class="collapsible-header" id="advanced-flows-collapse-header">
            <h3 style="margin: 0; cursor: pointer">Advanced Checkout Flows</h3>
            <span class="collapse-icon collapsed">▼</span>
          </div>
          <div
            class="config-collapsible collapsed"
            id="advanced-flows-collapse-content"
          >
            <div class="field">
              <label for="advanced-flow">Flow Type</label>
              <select id="advanced-flow">
                <option value="">None (Standard checkout)</option>
                <option value="TOKENIZED_PAYMENTS">Tokenized payments</option>
                <option
                  value="KLARNA_EXPRESS_CHECKOUT"
                  class="acquiring-partner-only"
                >
                  Interoperability - KLARNA_EXPRESS_CHECKOUT
                </option>
                <option
                  value="SIGN_IN_WITH_KLARNA"
                  class="acquiring-partner-only"
                >
                  Interoperability - SIGN_IN_WITH_KLARNA
                </option>
                <option
                  value="KLARNA_PRE_QUALIFICATION"
                  class="acquiring-partner-only"
                >
                  Interoperability - KLARNA_PRE_QUALIFICATION
                </option>
                <option
                  value="KLARNA_ACCOUNT_LINKING"
                  class="acquiring-partner-only"
                >
                  Interoperability - KLARNA_ACCOUNT_LINKING
                </option>
              </select>
            </div>
            <div
              class="status"
              id="customer-token-status"
              style="display: none"
            >
              Customer Token: <span id="customer-token-pill" class="pill"
              >configured</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Method Selector (SDK) -->
      <div class="panel selector-panel">
        <div class="selector">
          <h3>
            Payment Method Selector <span class="panel-badge sdk-badge"
            >SDK</span>
          </h3>

          <!-- Card Payment Option -->
          <label class="selector-option selected" id="option-card">
            <input type="radio" name="payment-option" value="CARD" checked>
            <div class="option-body">
              <div style="font-weight: 700; font-size: 16px; color: #0b051d">
                Card
              </div>
            </div>
            <div
              class="option-right"
              style="display: flex; gap: 8px; align-items: center"
            >
              <!-- Mastercard Logo -->
              <svg
                aria-hidden="true"
                role="img"
                width="33"
                height="22"
                fill="none"
                viewBox="0 0 33 22"
              >
                <path fill="#FF5F00" d="M20.288 4.198h-7.57v13.6h7.57v-13.6Z">
                </path>
                <path
                  fill="#EB001B"
                  d="M13.2 10.998a8.705 8.705 0 0 1 3.291-6.8C12.743 1.242 7.288 1.89 4.333 5.664 1.4 9.412 2.05 14.843 5.823 17.798a8.627 8.627 0 0 0 10.692 0 8.654 8.654 0 0 1-3.316-6.8Z"
                >
                </path>
                <path
                  fill="#F79E1B"
                  d="M30.5 10.998a8.645 8.645 0 0 1-8.65 8.65 8.562 8.562 0 0 1-5.335-1.85c3.749-2.955 4.398-8.386 1.442-12.158-.432-.529-.913-1.034-1.442-1.442 3.749-2.956 9.203-2.307 12.135 1.466a8.561 8.561 0 0 1 1.85 5.334Z"
                >
                </path>
              </svg>
              <!-- Visa Logo -->
              <svg
                aria-hidden="true"
                fill="none"
                height="22"
                role="img"
                viewBox="0 0 33 22"
                width="33"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="m12.89 6.171-3.927 9.371H6.4L4.468 8.064c-.118-.46-.22-.63-.577-.824-.582-.316-1.544-.612-2.391-.796l.058-.273h4.124c.526 0 .999.35 1.118.956l1.02 5.422 2.524-6.378h2.546Zm10.04 6.312c.011-2.474-3.42-2.61-3.395-3.715.007-.336.327-.693 1.028-.785.347-.045 1.304-.08 2.39.42l.425-1.988A6.514 6.514 0 0 0 21.111 6c-2.396 0-4.082 1.274-4.097 3.098-.015 1.349 1.204 2.101 2.122 2.55.945.459 1.262.754 1.259 1.164-.007.629-.754.907-1.452.917-1.218.02-1.925-.33-2.489-.591l-.44 2.053c.567.26 1.613.486 2.696.498 2.547 0 4.213-1.258 4.22-3.206Zm6.328 3.06H31.5L29.543 6.17h-2.07c-.465 0-.857.271-1.03.688l-3.639 8.683h2.546l.505-1.4h3.11l.293 1.4Zm-2.705-3.321 1.276-3.519.735 3.519h-2.01Zm-10.199-6.05-2.004 9.37h-2.424l2.005-9.37h2.423Z"
                  fill="#1434CB"
                >
                </path>
              </svg>
            </div>
          </label>

          <!-- Loading Placeholder (SDK) -->
          <div class="loading-placeholder" id="sdk-loading-placeholder">
            <div class="loading-body">
              <div class="skeleton skeleton-header"></div>
              <div class="skeleton skeleton-subheader"></div>
            </div>
            <div class="loading-icon"></div>
          </div>
          <div class="skeleton skeleton-button" id="sdk-loading-button"></div>

          <!-- Klarna Payment Option -->
          <label class="selector-option hidden" id="option-klarna">
            <input type="radio" name="payment-option" value="KLARNA" disabled>
            <div class="option-body">
              <div class="inline-row">
                <div id="opt1-header"></div>
              </div>
              <div id="opt1-subheader" style="margin-top: 2px"></div>
              <div id="opt1-message" class="message"></div>
            </div>
            <div class="option-right"><div id="opt1-icon"></div></div>
          </label>

          <!-- Klarna Saved Payment Option -->
          <label class="selector-option hidden" id="option-klarna-saved">
            <input
              type="radio"
              name="payment-option"
              value="KLARNA_SAVED"
              disabled
            >
            <div class="option-body">
              <div class="inline-row">
                <div id="opt2-header"></div>
                <div id="opt2-badge"></div>
              </div>
              <div id="opt2-subheader" style="margin-top: 2px"></div>
              <div id="opt2-message" class="message"></div>
            </div>
            <div class="option-right"><div id="opt2-icon"></div></div>
          </label>

          <!-- Payment Button Container -->
          <div id="action-button" style="margin-top: 16px"></div>
        </div>
        <!-- Presentation Info (SDK) -->
        <div class="presentation-info">
          <div class="presentation-info-row">
            <span class="presentation-info-label">Instruction:</span>
            <span
              id="sdk-presentation-instruction"
              class="presentation-info-value"
            >—</span>
          </div>
          <div class="presentation-info-row">
            <span class="presentation-info-label">Payment Option Id:</span>
            <span
              id="sdk-payment-option-id"
              class="presentation-info-value monospace copyable"
              title="Click to copy"
            >—</span>
          </div>
        </div>
      </div>

      <!-- Payment Method Selector (API) -->
      <div class="panel selector-panel">
        <div class="selector">
          <h3>
            Payment Method Selector <span class="panel-badge api-badge"
            >API</span>
          </h3>

          <!-- Card Payment Option (API) -->
          <label class="selector-option selected" id="api-option-card">
            <input type="radio" name="api-payment-option" value="CARD" checked>
            <div class="option-body">
              <div style="font-weight: 700; font-size: 16px; color: #0b051d">
                Card
              </div>
            </div>
            <div
              class="option-right"
              style="display: flex; gap: 8px; align-items: center"
            >
              <!-- Mastercard Logo -->
              <svg
                aria-hidden="true"
                role="img"
                width="33"
                height="22"
                fill="none"
                viewBox="0 0 33 22"
              >
                <path fill="#FF5F00" d="M20.288 4.198h-7.57v13.6h7.57v-13.6Z">
                </path>
                <path
                  fill="#EB001B"
                  d="M13.2 10.998a8.705 8.705 0 0 1 3.291-6.8C12.743 1.242 7.288 1.89 4.333 5.664 1.4 9.412 2.05 14.843 5.823 17.798a8.627 8.627 0 0 0 10.692 0 8.654 8.654 0 0 1-3.316-6.8Z"
                >
                </path>
                <path
                  fill="#F79E1B"
                  d="M30.5 10.998a8.645 8.645 0 0 1-8.65 8.65 8.562 8.562 0 0 1-5.335-1.85c3.749-2.955 4.398-8.386 1.442-12.158-.432-.529-.913-1.034-1.442-1.442 3.749-2.956 9.203-2.307 12.135 1.466a8.561 8.561 0 0 1 1.85 5.334Z"
                >
                </path>
              </svg>
              <!-- Visa Logo -->
              <svg
                aria-hidden="true"
                fill="none"
                height="22"
                role="img"
                viewBox="0 0 33 22"
                width="33"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="m12.89 6.171-3.927 9.371H6.4L4.468 8.064c-.118-.46-.22-.63-.577-.824-.582-.316-1.544-.612-2.391-.796l.058-.273h4.124c.526 0 .999.35 1.118.956l1.02 5.422 2.524-6.378h2.546Zm10.04 6.312c.011-2.474-3.42-2.61-3.395-3.715.007-.336.327-.693 1.028-.785.347-.045 1.304-.08 2.39.42l.425-1.988A6.514 6.514 0 0 0 21.111 6c-2.396 0-4.082 1.274-4.097 3.098-.015 1.349 1.204 2.101 2.122 2.55.945.459 1.262.754 1.259 1.164-.007.629-.754.907-1.452.917-1.218.02-1.925-.33-2.489-.591l-.44 2.053c.567.26 1.613.486 2.696.498 2.547 0 4.213-1.258 4.22-3.206Zm6.328 3.06H31.5L29.543 6.17h-2.07c-.465 0-.857.271-1.03.688l-3.639 8.683h2.546l.505-1.4h3.11l.293 1.4Zm-2.705-3.321 1.276-3.519.735 3.519h-2.01Zm-10.199-6.05-2.004 9.37h-2.424l2.005-9.37h2.423Z"
                  fill="#1434CB"
                >
                </path>
              </svg>
            </div>
          </label>

          <!-- Loading Placeholder (API) -->
          <div class="loading-placeholder" id="api-loading-placeholder">
            <div class="loading-body">
              <div class="skeleton skeleton-header"></div>
              <div class="skeleton skeleton-subheader"></div>
            </div>
            <div class="loading-icon"></div>
          </div>
          <div class="skeleton skeleton-button" id="api-loading-button"></div>

          <!-- Klarna Payment Option (API) -->
          <label class="selector-option hidden" id="api-option-klarna">
            <input
              type="radio"
              name="api-payment-option"
              value="KLARNA"
              disabled
            >
            <div class="option-body">
              <div class="inline-row">
                <div id="api-opt1-header" class="api-text-header"></div>
              </div>
              <div
                id="api-opt1-subheader"
                class="api-text-subheader"
                style="margin-top: 2px"
              >
              </div>
              <div id="api-opt1-message" class="message api-text-message"></div>
            </div>
            <div class="option-right">
              <img id="api-opt1-icon" class="api-icon" alt="" />
            </div>
          </label>

          <!-- Klarna Saved Payment Option (API) -->
          <label class="selector-option hidden" id="api-option-klarna-saved">
            <input
              type="radio"
              name="api-payment-option"
              value="KLARNA_SAVED"
              disabled
            >
            <div class="option-body">
              <div class="inline-row">
                <div id="api-opt2-header" class="api-text-header"></div>
                <div id="api-opt2-badge" class="api-badge-text"></div>
              </div>
              <div
                id="api-opt2-subheader"
                class="api-text-subheader"
                style="margin-top: 2px"
              >
              </div>
              <div id="api-opt2-message" class="message api-text-message"></div>
            </div>
            <div class="option-right">
              <img id="api-opt2-icon" class="api-icon" alt="" />
            </div>
          </label>

          <!-- Payment Button Container (API) -->
          <div id="api-action-button" style="margin-top: 16px"></div>
        </div>
        <!-- Presentation Info (API) -->
        <div class="presentation-info">
          <div class="presentation-info-row">
            <span class="presentation-info-label">Instruction:</span>
            <span
              id="api-presentation-instruction"
              class="presentation-info-value"
            >—</span>
          </div>
          <div class="presentation-info-row">
            <span class="presentation-info-label">Payment Option Id:</span>
            <span
              id="api-payment-option-id"
              class="presentation-info-value monospace copyable"
              title="Click to copy"
            >—</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Log Panels -->
    <div class="logs-row">
      <!-- SDK Payment Selector Logs -->
      <div class="panel log-panel">
        <div class="log-header">
          <h3>
            Payment Method Selector Logs<span class="panel-badge sdk-badge"
            >SDK</span>
          </h3>
          <button id="clear-sdk-log-btn" class="clear-btn">Clear</button>
        </div>
        <div class="log-content" id="sdk-log-content">
          <p class="log-placeholder">
            SDK events and backend calls will appear here...
          </p>
        </div>
      </div>

      <!-- API Payment Selector Logs -->
      <div class="panel log-panel">
        <div class="log-header">
          <h3>
            Payment Method Selector Logs <span class="panel-badge api-badge"
            >API</span>
          </h3>
          <button id="clear-api-log-btn" class="clear-btn">Clear</button>
        </div>
        <div class="log-content" id="api-log-content">
          <p class="log-placeholder">Backend calls will appear here...</p>
        </div>
      </div>
    </div>

    <script type="module" src="/js/main.js"></script>
  </body>
</html>
